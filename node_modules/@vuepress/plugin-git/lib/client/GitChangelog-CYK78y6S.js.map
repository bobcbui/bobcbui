{"version":3,"file":"GitChangelog-CYK78y6S.js","sources":["../../src/client/options.ts","../../src/client/utils/resolveRepoLink.ts","../../src/client/composables/useChangelog.ts","../../src/client/composables/useLastUpdated.ts","../../src/client/components/GitChangelog.ts"],"sourcesContent":["import type { GitInjectOptions } from '../shared/index.js'\n\ndeclare const __GIT_OPTIONS__: GitInjectOptions\n\nexport const gitOptions =\n  typeof __GIT_OPTIONS__ === 'undefined' ? {} : __GIT_OPTIONS__\n","import { isLinkHttp } from '@vuepress/helper/client'\nimport type { KnownGitProvider } from '../../shared/index.js'\n\nexport const resolveRepoLink = (\n  link?: string,\n  provider?: KnownGitProvider | null,\n): string | undefined => {\n  if (!link || isLinkHttp(link)) return link\n\n  if (provider === 'github') return `https://github.com/${link}`\n\n  if (provider === 'gitee') return `https://gitee.com/${link}`\n\n  return link\n}\n","import type { ComputedRef, MaybeRefOrGetter } from 'vue'\nimport { computed, toValue } from 'vue'\nimport { usePageData, usePageFrontmatter, usePageLang } from 'vuepress/client'\nimport type {\n  GitChangelogInfo,\n  GitPluginFrontmatter,\n  GitPluginPageData,\n} from '../../shared/index.js'\nimport { gitOptions } from '../options.js'\nimport { resolveRepoLink } from '../utils/index.js'\n\ndeclare const __GIT_CHANGELOG__: boolean\n\nexport interface GitChangelogItem extends GitChangelogInfo {\n  date: string\n}\n\nconst RE_ISSUE = /#(\\d+)/g\n\nexport const useChangelog =\n  typeof __GIT_CHANGELOG__ === 'boolean' && __GIT_CHANGELOG__\n    ? (\n        enabled: MaybeRefOrGetter<boolean> = true,\n      ): ComputedRef<GitChangelogItem[]> => {\n        const frontmatter = usePageFrontmatter<GitPluginFrontmatter>()\n        const lang = usePageLang()\n        const page = usePageData<GitPluginPageData>()\n\n        const { pattern = {}, provider } = gitOptions\n        const repo = resolveRepoLink(gitOptions.repo, provider)\n\n        return computed(() => {\n          if (frontmatter.value.changelog === false || !toValue(enabled))\n            return []\n\n          const formatter = new Intl.DateTimeFormat(lang.value, {\n            dateStyle: 'short',\n          })\n\n          // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n          return (page.value.git?.changelog ?? []).map((item) => {\n            const res: GitChangelogItem = {\n              date: formatter.format(item.time),\n              ...item,\n            }\n\n            if (pattern.issue && repo) {\n              res.message = res.message.replace(\n                RE_ISSUE,\n                (matched, issue: string) => {\n                  const url = pattern\n                    .issue!.replace(':issue', issue)\n                    .replace(':repo', repo)\n                  return `<a href=\"${url}\" target=\"_blank\" rel=\"noopener noreferrer\">${matched}</a>`\n                },\n              )\n            }\n\n            if (pattern.commit && repo) {\n              res.commitUrl = pattern.commit\n                .replace(':hash', res.hash)\n                .replace(':repo', repo)\n            }\n\n            if (pattern.tag && repo && res.tag)\n              res.tagUrl = pattern.tag\n                .replace(':tag', res.tag)\n                .replace(':repo', repo)\n\n            return res\n          })\n        })\n      }\n    : (): ComputedRef<GitChangelogItem[]> => computed(() => [])\n","import type { ComputedRef, MaybeRefOrGetter } from 'vue'\nimport { computed, toValue } from 'vue'\nimport { usePageData, usePageLang } from 'vuepress/client'\nimport type { GitPluginPageData } from '../../shared/index.js'\nimport { useGitLocaleConfig } from './useGitLocales.js'\n\nexport interface LastUpdated {\n  /**\n   * The date object of the last updated time\n   */\n  date: Date\n  /**\n   * The ISO string of the last updated time\n   */\n  iso: string\n  /**\n   * The formatted text of the last updated time\n   */\n  text: string\n  /**\n   * The locale of the last updated time\n   */\n  locale: string\n}\n\nexport const useLastUpdated = (\n  enabled: MaybeRefOrGetter<boolean> = true,\n): ComputedRef<LastUpdated | null> => {\n  const lang = usePageLang()\n  const locale = useGitLocaleConfig()\n  const page = usePageData<GitPluginPageData>()\n\n  return computed(() => {\n    if (!toValue(enabled)) return null\n\n    const timeStamp =\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      page.value.git?.updatedTime ?? page.value.git?.changelog?.[0].time\n\n    if (!timeStamp) return null\n\n    const date = new Date(timeStamp)\n\n    const text = new Intl.DateTimeFormat(lang.value, {\n      dateStyle: 'short',\n      timeStyle: 'short',\n    }).format(timeStamp)\n\n    return {\n      date,\n      text,\n      iso: date.toISOString(),\n      locale: locale.value.latestUpdateAt,\n    }\n  })\n}\n","import { useToggle } from '@vueuse/core'\nimport type { FunctionalComponent } from 'vue'\nimport { defineComponent, h } from 'vue'\nimport type { GitChangelogItem } from '../composables/index.js'\nimport {\n  useChangelog,\n  useGitLocaleConfig,\n  useLastUpdated,\n} from '../composables/index.js'\nimport { VPHeader } from './VPHeader.js'\n\nimport '../styles/vars.css'\nimport '../styles/changelog.css'\n\nexport const GitChangelog = defineComponent({\n  name: 'GitChangelog',\n\n  props: {\n    /** Title of changelog */\n    title: String,\n\n    /** header level of changelog */\n    headerLevel: {\n      type: Number,\n      default: 2,\n    },\n  },\n\n  setup(props) {\n    const changelog = useChangelog()\n    const locale = useGitLocaleConfig()\n    const lastUpdated = useLastUpdated()\n\n    const [active, toggleActive] = useToggle()\n\n    const ChangelogHeader: FunctionalComponent = () =>\n      h(\n        'div',\n        { class: 'vp-changelog-header', onClick: () => toggleActive() },\n        [\n          h('div', { class: 'vp-latest-updated' }, [\n            h('span', { class: 'vp-changelog-icon' }),\n            h('span', { 'data-allow-mismatch': '' }, lastUpdated.value!.text),\n          ]),\n          h('div', [\n            h('span', { class: 'vp-changelog-menu-icon' }),\n            h('span', locale.value.viewChangelog),\n          ]),\n        ],\n      )\n\n    const ReleaseTag: FunctionalComponent<{ item: GitChangelogItem }> = ({\n      item,\n    }) =>\n      h(\n        'li',\n        { class: 'vp-changelog-item-tag' },\n        h('div', [\n          h('a', { class: 'vp-changelog-tag' }, h('code', item.tag)),\n          h(\n            'span',\n            { 'class': 'vp-changelog-date', 'data-allow-mismatch': '' },\n            [\n              locale.value.timeOn,\n              ' ',\n              h(\n                'time',\n                { datetime: new Date(item.time).toISOString() },\n                item.date,\n              ),\n            ],\n          ),\n        ]),\n      )\n\n    const Commit: FunctionalComponent<{ item: GitChangelogItem }> = ({\n      item,\n    }) =>\n      h('li', { class: 'vp-changelog-item-commit' }, [\n        h(\n          item.commitUrl ? 'a' : 'span',\n          {\n            class: 'vp-changelog-hash',\n            href: item.commitUrl,\n            target: '_blank',\n            rel: 'noreferrer',\n          },\n          [h('code', item.hash.slice(0, 5))],\n        ),\n        h('span', { class: 'vp-changelog-divider' }, '-'),\n        h('span', { class: 'vp-changelog-message', innerHTML: item.message }),\n        h('span', { 'class': 'vp-changelog-date', 'data-allow-mismatch': '' }, [\n          locale.value.timeOn || 'on',\n          ' ',\n          h('time', { datetime: new Date(item.time).toISOString() }, item.date),\n        ]),\n      ])\n\n    return () =>\n      changelog.value.length\n        ? [\n            h(VPHeader, {\n              level: props.headerLevel,\n              anchor: 'doc-changelog',\n              text: props.title || locale.value.changelog,\n            }),\n\n            h(\n              'div',\n              { class: ['vp-changelog-wrapper', { active: active.value }] },\n              [\n                h(ChangelogHeader),\n\n                h('ul', { class: 'vp-changelog-list' }, [\n                  changelog.value.map((item) =>\n                    item.tag\n                      ? h(ReleaseTag, { item, key: item.tag })\n                      : h(Commit, { item, key: item.hash }),\n                  ),\n                ]),\n              ],\n            ),\n          ]\n        : null\n  },\n})\n"],"names":["gitOptions","resolveRepoLink","link","provider","isLinkHttp","RE_ISSUE","useChangelog","enabled","frontmatter","usePageFrontmatter","lang","usePageLang","page","usePageData","pattern","repo","computed","toValue","formatter","item","res","matched","issue","useLastUpdated","locale","useGitLocaleConfig","timeStamp","date","text","GitChangelog","defineComponent","props","changelog","lastUpdated","active","toggleActive","useToggle","ChangelogHeader","h","ReleaseTag","Commit","VPHeader"],"mappings":"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"}